<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Casamento Eduardo & Amanda</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f7f4ff;
  color: #444;
  text-align: center;
}
.container { max-width: 480px; margin: auto; padding: 20px; }
h1 { color: #6a4bc3; }
p { font-size: 16px; line-height: 1.5; }
.hidden { display: none; }
video, img { width: 100%; border-radius: 12px; margin-top: 15px; }
button {
  width: 100%;
  padding: 16px;
  margin-top: 12px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: transform 0.1s ease;
}
button:active { transform: scale(0.97); }
.start { background: #6a4bc3; color: #fff; }
.send { background: #2e7d32; color: #fff; }
.retry { background: #e0e0e0; }
.success { margin-top: 30px; font-size: 20px; color: #2e7d32; opacity: 0; transition: all 0.5s ease; }
.success.show { opacity: 1; transform: translateY(0); }
.slider-container { margin-top: 12px; text-align: left; }
.slider-container label { display: block; font-size: 14px; margin-bottom: 4px; }
.slider-container input[type=range] { width: 100%; }
</style>
</head>
<body>
<div class="container">

<!-- Boas-vindas -->
<div id="welcome">
  <h1>ğŸ’ Eduardo & Amanda</h1>
  <p>Obrigado por celebrar conosco â¤ï¸<br>Clique abaixo para tirar sua foto!</p>
  <button id="startCamera" class="start">ğŸ“¸ ComeÃ§ar</button>
</div>

<!-- Escolha de cÃ¢mera -->
<div id="cameraChoice" class="hidden">
  <p>Escolha a cÃ¢mera:</p>
  <button onclick="abrirCamera('user')">ğŸ“· Frontal</button>
  <button onclick="abrirCamera('environment')">ğŸ“¸ Traseira</button>
</div>

<!-- VisualizaÃ§Ã£o da cÃ¢mera -->
<div id="cameraContainer" class="hidden">
  <video id="cameraVideo" autoplay playsinline muted></video>
  <div id="cameraControls" class="slider-container hidden">
    <label for="focusRange">Foco</label>
    <input type="range" id="focusRange" min="0" max="100" value="50">
    <label for="exposureRange">Sensibilidade (ExposiÃ§Ã£o)</label>
    <input type="range" id="exposureRange" min="0" max="100" value="50">
    <label for="zoomRange">Zoom</label>
    <input type="range" id="zoomRange" min="1" max="1" value="1" step="0.01">
  </div>
  <div id="cameraActions">
    <button id="takePhotoButton">ğŸ“¸ Tirar Foto</button>
    <button onclick="cancelarCamera()">âŒ Cancelar</button>
  </div>
</div>

<!-- PrÃ©-visualizaÃ§Ã£o -->
<div id="previewContainer" class="hidden">
  <div id="preview"></div>
  <div id="actions" class="hidden">
    <button id="sendButton" class="send">ğŸ“¤ Enviar</button>
    <button type="button" class="retry" onclick="resetar()">ğŸ”„ Refazer</button>
  </div>
</div>

<!-- Sucesso -->
<div id="success" class="success">
  âœ… <strong>SALVO E ENVIADO!</strong><br>
  Muito obrigado por compartilhar esse momento especial ğŸ’–<br>
  Sua foto jÃ¡ pode aparecer na TV!
</div>

</div>

<script>
let stream, track, mediaBlob;
const startButton = document.getElementById("startCamera");
const cameraChoice = document.getElementById("cameraChoice");
const cameraContainer = document.getElementById("cameraContainer");
const cameraVideo = document.getElementById("cameraVideo");
const previewContainer = document.getElementById("previewContainer");
const preview = document.getElementById("preview");
const actions = document.getElementById("actions");
const success = document.getElementById("success");
const takePhotoButton = document.getElementById("takePhotoButton");
const cameraControls = document.getElementById("cameraControls");
const focusRange = document.getElementById("focusRange");
const exposureRange = document.getElementById("exposureRange");
const zoomRange = document.getElementById("zoomRange");

// Fluxo inicial
startButton.onclick = () => {
  document.getElementById("welcome").classList.add("hidden");
  cameraChoice.classList.remove("hidden");
};

// Abrir cÃ¢mera frontal ou traseira
async function abrirCamera(facing) {
  cameraChoice.classList.add("hidden");
  cameraContainer.classList.remove("hidden");
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: facing }, audio: false });
    track = stream.getVideoTracks()[0];
    cameraVideo.srcObject = stream;
    cameraVideo.play().catch(console.log);

    // Controles
    const capabilities = track.getCapabilities();
    cameraControls.classList.remove("hidden");
    // Foco
    if(capabilities.focusDistance){
      focusRange.min = capabilities.focusDistance.min;
      focusRange.max = capabilities.focusDistance.max;
      focusRange.step = capabilities.focusDistance.step || 0.01;
      focusRange.value = (capabilities.focusDistance.min + capabilities.focusDistance.max)/2;
    } else { focusRange.parentElement.style.display="none"; }
    // ExposiÃ§Ã£o
    if(capabilities.exposureCompensation){
      exposureRange.min = capabilities.exposureCompensation.min;
      exposureRange.max = capabilities.exposureCompensation.max;
      exposureRange.step = capabilities.exposureCompensation.step || 0.01;
      exposureRange.value = 0;
    } else { exposureRange.parentElement.style.display="none"; }
    // Zoom
    if(capabilities.zoom){
      zoomRange.min = capabilities.zoom.min;
      zoomRange.max = capabilities.zoom.max;
      zoomRange.step = capabilities.zoom.step || 0.01;
      zoomRange.value = 1;
    } else { zoomRange.parentElement.style.display="none"; }

  } catch(err){
    console.error(err);
    alert("NÃ£o foi possÃ­vel acessar a cÃ¢mera.");
    location.reload();
  }
}

// Ajustes em tempo real
focusRange.oninput = ()=>{ track?.applyConstraints({advanced:[{focusMode:"manual",focusDistance:parseFloat(focusRange.value)}]}).catch(console.log); }
exposureRange.oninput = ()=>{ track?.applyConstraints({advanced:[{exposureMode:"manual",exposureCompensation:parseFloat(exposureRange.value)}]}).catch(console.log); }
zoomRange.oninput = ()=>{ track?.applyConstraints({advanced:[{zoom:parseFloat(zoomRange.value)}]}).catch(console.log); }

// Cancelar cÃ¢mera
function cancelarCamera(){ stopStream(); location.reload(); }
function stopStream(){ stream?.getTracks().forEach(t=>t.stop()); stream=null; track=null; }

// Tirar foto
takePhotoButton.onclick = ()=>{
  const canvas=document.createElement("canvas");
  canvas.width=cameraVideo.videoWidth;
  canvas.height=cameraVideo.videoHeight;
  canvas.getContext("2d").drawImage(cameraVideo,0,0);
  canvas.toBlob(blob=>{
    mediaBlob=blob;
    const img=document.createElement("img");
    img.src=URL.createObjectURL(blob);
    previewContainer.classList.remove("hidden");
    preview.innerHTML="";
    preview.appendChild(img);
    actions.classList.remove("hidden");
    cameraContainer.classList.add("hidden");
    stopStream();
  },"image/png");
}

// Resetar
function resetar(){
  mediaBlob=null;
  preview.innerHTML="";
  actions.classList.add("hidden");
  previewContainer.classList.add("hidden");
  cameraContainer.classList.remove("hidden");
  cameraContainer.scrollIntoView({behavior:"smooth"});
}

// Envio
document.getElementById("sendButton").onclick = async ()=>{
  if(!mediaBlob) return alert("Nenhuma foto para enviar.");
  const formData=new FormData();
  formData.append("arquivo",mediaBlob,"foto.png");
  formData.append("_captcha","false");
  formData.append("_subject","Casamento Eduardo & Amanda - Foto enviada");
  try{
    await fetch("https://formsubmit.co/eduardo.goncalves27@gmail.com",{method:"POST",body:formData});
    previewContainer.classList.add("hidden");
    actions.classList.add("hidden");
    success.classList.add("show");
    setTimeout(()=>location.reload(),2000);
  }catch(err){ alert("Erro ao enviar. Tente novamente."); }
};
</script>
</body>
</html>
