<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Casamento Eduardo & Amanda</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f7f4ff;
  color: #444;
  text-align: center;
}
.container { max-width: 480px; margin: auto; padding: 20px; }
h1 { color: #6a4bc3; }
p { font-size: 16px; line-height: 1.5; }
.hidden { display: none; }
video, img { width: 100%; border-radius: 12px; margin-top: 15px; }
button {
  width: 100%;
  padding: 16px;
  margin-top: 12px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  transition: transform 0.1s ease;
}
button:active { transform: scale(0.97); }
.start { background: #6a4bc3; color: #fff; }
.send { background: #2e7d32; color: #fff; }
.retry { background: #e0e0e0; }
.success { margin-top: 30px; font-size: 20px; color: #2e7d32; opacity: 0; transition: all 0.5s ease; }
.success.show { opacity: 1; transform: translateY(0); }
#cameraWrapper { position: relative; }
#shutterButton {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: #6a4bc3;
  border: 4px solid #fff;
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  cursor: pointer;
}
</style>
</head>
<body>
<div class="container">

<!-- Boas-vindas -->
<div id="welcome">
  <h1>ğŸ’ Eduardo & Amanda</h1>
  <p>Obrigado por celebrar conosco â¤ï¸<br>Clique abaixo para tirar sua foto!</p>
  <button id="startCamera" class="start">ğŸ“¸ ComeÃ§ar</button>
</div>

<!-- Escolha de cÃ¢mera -->
<div id="cameraChoice" class="hidden">
  <p>Escolha a cÃ¢mera:</p>
  <button onclick="abrirCamera('user')">ğŸ“· Frontal</button>
  <button onclick="abrirCamera('environment')">ğŸ“¸ Traseira</button>
</div>

<!-- CÃ¢mera -->
<div id="cameraContainer" class="hidden">
  <div id="cameraWrapper">
    <video id="cameraVideo" autoplay playsinline muted></video>
    <div id="shutterButton" onclick="tirarFoto()"></div>
  </div>
  <button onclick="cancelarCamera()" style="margin-top: 12px;">âŒ Cancelar</button>
</div>

<!-- PrÃ©-visualizaÃ§Ã£o -->
<div id="previewContainer" class="hidden">
  <div id="preview"></div>
  <div id="actions" class="hidden">
    <button id="sendButton" class="send">ğŸ“¤ Enviar</button>
    <button type="button" class="retry" onclick="refazerFoto()">ğŸ”„ Refazer</button>
  </div>
</div>

<!-- Sucesso -->
<div id="success" class="success">
  âœ… <strong>SALVO E ENVIADO!</strong><br>
  Muito obrigado por compartilhar esse momento especial ğŸ’–<br>
  Sua foto jÃ¡ pode aparecer na TV!
</div>

</div>

<script>
let stream, mediaBlob;

const startButton = document.getElementById("startCamera");
const cameraChoice = document.getElementById("cameraChoice");
const cameraContainer = document.getElementById("cameraContainer");
const cameraVideo = document.getElementById("cameraVideo");
const previewContainer = document.getElementById("previewContainer");
const preview = document.getElementById("preview");
const actions = document.getElementById("actions");
const success = document.getElementById("success");

// Iniciar fluxo
startButton.onclick = () => {
  document.getElementById("welcome").classList.add("hidden");
  cameraChoice.classList.remove("hidden");
};

// Abrir cÃ¢mera com getUserMedia
async function abrirCamera(facing){
  cameraChoice.classList.add("hidden");
  cameraContainer.classList.remove("hidden");
  try{
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: facing }, audio: false });
    cameraVideo.srcObject = stream;
    cameraVideo.play();
  }catch(err){
    console.error(err);
    alert("NÃ£o foi possÃ­vel acessar a cÃ¢mera.");
    location.reload();
  }
}

// Tirar foto
function tirarFoto(){
  const canvas = document.createElement("canvas");
  canvas.width = cameraVideo.videoWidth;
  canvas.height = cameraVideo.videoHeight;
  canvas.getContext("2d").drawImage(cameraVideo,0,0);
  canvas.toBlob(blob=>{
    mediaBlob = blob;
    const img = document.createElement("img");
    img.src = URL.createObjectURL(blob);
    previewContainer.classList.remove("hidden");
    preview.innerHTML = "";
    preview.appendChild(img);
    actions.classList.remove("hidden");
    cameraContainer.classList.add("hidden");
    stopStream();
  }, "image/png");
}

// Refazer foto
function refazerFoto(){
  mediaBlob = null;
  preview.innerHTML = "";
  actions.classList.add("hidden");
  previewContainer.classList.add("hidden");
  cameraContainer.classList.remove("hidden");
  cameraContainer.scrollIntoView({behavior:"smooth"});
  // Reabrir cÃ¢mera
  reabrirCamera();
}

// Cancelar cÃ¢mera
function cancelarCamera(){
  stopStream();
  location.reload();
}

// Parar cÃ¢mera
function stopStream(){
  stream?.getTracks().forEach(track=>track.stop());
  stream = null;
}

// Reabrir cÃ¢mera para refazer
async function reabrirCamera(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
    cameraVideo.srcObject = stream;
    cameraVideo.play();
  }catch(err){
    console.error(err);
  }
}

// Enviar foto
document.getElementById("sendButton").onclick = async ()=>{
  if(!mediaBlob) return alert("Nenhuma foto para enviar.");
  const formData = new FormData();
  formData.append("arquivo", mediaBlob, "foto.png");
  formData.append("_captcha","false");
  formData.append("_subject","Casamento Eduardo & Amanda - Foto enviada");
  try{
    await fetch("https://formsubmit.co/eduardo.goncalves27@gmail.com",{method:"POST", body:formData});
    previewContainer.classList.add("hidden");
    actions.classList.add("hidden");
    success.classList.add("show");
    setTimeout(()=>location.reload(),2000);
  }catch(err){ alert("Erro ao enviar. Tente novamente."); }
};
</script>
</body>
</html>
